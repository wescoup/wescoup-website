<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tony's Tennis Tracker 2.0</title>
    <link rel="stylesheet" href="/static/css/tennisstyles.css">
</head>
<body class="tennis-tracker-body">
    <div class="tennis-tracker-container">
        <div class="tennis-tracker-header">
            <h1>🎾 Tony's Tennis Tracker 2.0</h1>
            <p id="match-info-display">Enhanced with second shot tracking</p>
        </div>

        <!-- Navigation -->
        <div class="tennis-nav">
            <button class="tennis-nav-btn active" id="setup-tab" onclick="showTab('setup')">Match Info</button>
            <button class="tennis-nav-btn" id="tracking-tab" onclick="showTab('tracking')">Track Match</button>
            <button class="tennis-nav-btn" id="results-tab" onclick="showTab('results')">Results</button>
            <button class="tennis-nav-btn" onclick="window.location.href='/tonys-tennis-page'">Tony's Tennis Page</button>
        </div>

        <!-- Setup Section -->
        <div class="tennis-section active" id="setup-section">
            <h2>Match Setup</h2>
            
            <div class="tennis-form-group">
                <label for="player1-name">Player 1:</label>
                <input type="text" id="player1-name" class="tennis-form-group input" value="Player 1">
            </div>
            
            <div class="tennis-form-group">
                <label for="player2-name">Player 2:</label>
                <input type="text" id="player2-name" class="tennis-form-group input" value="Player 2">
            </div>
            
            <div class="tennis-form-group">
                <label for="match-date">Date:</label>
                <input type="date" id="match-date" class="tennis-form-group input">
            </div>
            
            <div class="tennis-form-group">
                <label for="match-location">Location:</label>
                <input type="text" id="match-location" class="tennis-form-group input" value="Local Court">
            </div>
            
            <div class="tennis-form-group">
                <label for="match-surface">Surface:</label>
                <select id="match-surface" class="tennis-form-group select">
                    <option value="Hard">Hard</option>
                    <option value="Clay">Clay</option>
                    <option value="Grass">Grass</option>
                    <option value="Indoor">Indoor</option>
                </select>
            </div>
            <!--
            <div class="tennis-btn-group">
                <button onclick="startMatch()" class="tennis-btn">🚀 Start Match</button>
                <a href="/tonys-tennis-page" class="tennis-btn">← Back to Tennis Page</a>
            </div>
            -->
        </div>

        <!-- Tracking Section -->
        <div class="tennis-section" id="tracking-section">
            <h2>Match Tracking</h2>
            
            <!-- Score Display -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label" id="player1-display">Player 1</div>
                    <div class="stat-value" id="player1-games">0</div>
                    <button onclick="adjustGames('player1', 1)" class="tennis-btn">+</button>
                    <button onclick="adjustGames('player1', -1)" class="tennis-btn">-</button>
                </div>
                <div class="stat-card">
                    <div class="stat-label" id="player2-display">Player 2</div>
                    <div class="stat-value" id="player2-games">0</div>
                    <button onclick="adjustGames('player2', 1)" class="tennis-btn">+</button>
                    <button onclick="adjustGames('player2', -1)" class="tennis-btn">-</button>
                </div>
            </div>

            <!-- Server Selection -->
            <div class="stat-card">
                <div class="stat-label">Current Server</div>
                <div class="stat-value" id="current-server">Player 1</div>
                <button onclick="changeServer()" class="tennis-btn">Change Server</button>
            </div>

            <!-- Serve Tracking -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">First Serve</div>
                    <div class="serve-data" id="first-serve-data">-</div>
                    <div class="stat-value" id="first-serve-percent">0%</div>
                    <button onclick="recordServe('first', 'win')" class="tennis-btn">Win</button>
                    <button onclick="recordServe('first', 'lose')" class="tennis-btn">Loss</button>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Second Serve</div>
                    <div class="serve-data" id="second-serve-data">-</div>
                    <div class="stat-value" id="second-serve-percent">0%</div>
                    <button onclick="recordServe('second', 'win')" class="tennis-btn">Win</button>
                    <button onclick="recordServe('second', 'lose')" class="tennis-btn">Loss</button>
                </div>
            </div>
            <div class="tennis-btn-group">
                <button onclick="undoServe()" class="tennis-btn">↶ Undo</button>
                <button onclick="gameComplete()" class="tennis-btn">✓ Game Complete</button>
            </div>

            <!-- NEW: Second Shot Tracking -->
            <div class="stat-card" style="background: rgba(255, 193, 7, 0.2); border: 2px solid rgba(255, 193, 7, 0.5);">
                <h3>🎯 Second Shot Tracking</h3>
                <p style="font-size: 0.9rem; opacity: 0.8;">Only press when someone misses their second ball</p>
                
                <div class="tennis-btn-group">
                    <button onclick="recordSecondShotMiss('server')" class="tennis-btn" style="background: rgba(255, 193, 7, 0.8);">Server Missed 2nd Shot</button>
                    <button onclick="recordSecondShotMiss('returner')" class="tennis-btn" style="background: rgba(255, 193, 7, 0.8);">Returner Missed 2nd Shot</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Server Misses</div>
                        <div class="stat-value" id="server-misses">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Returner Misses</div>
                        <div class="stat-value" id="returner-misses">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="tennis-section" id="results-section">
            <h2>Match Results</h2>
            
            <!-- Final Score -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label" id="final-player1">Player 1</div>
                    <div class="stat-value" id="final-player1-score">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" id="final-player2">Player 2</div>
                    <div class="stat-value" id="final-player2-score">0</div>
                </div>
            </div>

            <!-- Serve Statistics -->
            <h3>Serve Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label" id="serve-p1-name">Player 1</div>
                    <div>1st Serve: <span class="stat-value" id="p1-first-pct">0%</span></div>
                    <div>1st Win: <span class="stat-value" id="p1-first-win-pct">0%</span></div>
                    <div>2nd Win: <span class="stat-value" id="p1-second-win-pct">0%</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" id="serve-p2-name">Player 2</div>
                    <div>1st Serve: <span class="stat-value" id="p2-first-pct">0%</span></div>
                    <div>1st Win: <span class="stat-value" id="p2-first-win-pct">0%</span></div>
                    <div>2nd Win: <span class="stat-value" id="p2-second-win-pct">0%</span></div>
                </div>
            </div>

            <!-- NEW: Second Shot Results -->
            <h3>🎯 Second Shot Analysis</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label" id="second-p1-name">Player 1</div>
                    <div>Total Misses: <span class="stat-value" id="p1-second-misses">0</span></div>
                    <div class="stat-label" id="p1-analysis">Good consistency</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" id="second-p2-name">Player 2</div>
                    <div>Total Misses: <span class="stat-value" id="p2-second-misses">0</span></div>
                    <div class="stat-label" id="p2-analysis">Good consistency</div>
                </div>
            </div>

            <div class="stat-card">
                <h4>💡 Match Insight</h4>
                <p id="match-insight">Second shot analysis will appear here</p>
            </div>

            <!-- Actions -->
            <div class="tennis-btn-group">
                <button onclick="newMatch()" class="tennis-btn">🆕 New Match</button>
                <button onclick="takeScreenshot()" class="tennis-btn">📸 Screenshot</button>
                <a href="/tonys-tennis-page" class="tennis-btn">🏠 Tennis Page</a>
            </div>
        </div>
    </div>

    <script>
        // Match data
        let matchData = {
            player1: { name: 'Player 1', games: 0, firstServe: '', secondServe: '', secondShotMisses: 0 },
            player2: { name: 'Player 2', games: 0, firstServe: '', secondServe: '', secondShotMisses: 0 },
            currentServer: 0, // 0 = player1, 1 = player2
            matchInfo: { date: '', location: '', surface: '' }
        };

        function init() {
            document.getElementById('match-date').value = new Date().toISOString().split('T')[0];
        }

        function showTab(tabName) {
            // Update nav buttons
            document.querySelectorAll('.tennis-nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update sections
            document.querySelectorAll('.tennis-section').forEach(section => section.classList.remove('active'));
            document.getElementById(tabName + '-section').classList.add('active');
        }

        function startMatch() {
            // Get form data
            matchData.player1.name = document.getElementById('player1-name').value || 'Player 1';
            matchData.player2.name = document.getElementById('player2-name').value || 'Player 2';
            matchData.matchInfo.date = document.getElementById('match-date').value;
            matchData.matchInfo.location = document.getElementById('match-location').value;
            matchData.matchInfo.surface = document.getElementById('match-surface').value;

            // Update displays
            updateAllDisplays();
            
            // Switch to tracking
            showTab('tracking');
        }

        function changeServer() {
            matchData.currentServer = matchData.currentServer === 0 ? 1 : 0;
            updateAllDisplays();
        }

        function adjustGames(player, change) {
            matchData[player].games = Math.max(0, matchData[player].games + change);
            updateAllDisplays();
        }

        function recordServe(type, result) {
            const server = matchData.currentServer === 0 ? matchData.player1 : matchData.player2;
            const value = result === 'win' ? '1' : '0';
            
            if (type === 'first') {
                server.firstServe += value;
            } else {
                server.secondServe += value;
            }
            updateAllDisplays();
        }

        function recordSecondShotMiss(shotType) {
            if (shotType === 'server') {
                const server = matchData.currentServer === 0 ? matchData.player1 : matchData.player2;
                server.secondShotMisses++;
            } else {
                const returner = matchData.currentServer === 0 ? matchData.player2 : matchData.player1;
                returner.secondShotMisses++;
            }
            updateAllDisplays();
        }

        function undoServe() {
            const server = matchData.currentServer === 0 ? matchData.player1 : matchData.player2;
            if (server.secondServe.length > 0) {
                server.secondServe = server.secondServe.slice(0, -1);
            } else if (server.firstServe.length > 0) {
                server.firstServe = server.firstServe.slice(0, -1);
            }
            updateAllDisplays();
        }

        function gameComplete() {
            const server = matchData.currentServer === 0 ? matchData.player1 : matchData.player2;
            server.firstServe += ',';
            server.secondServe += ',';
            updateAllDisplays();
        }

        function updateAllDisplays() {
            // Update match info
            document.getElementById('match-info-display').textContent = 
                `${matchData.matchInfo.date} • ${matchData.matchInfo.location} • ${matchData.matchInfo.surface}`;
            
            // Update player names
            document.getElementById('player1-display').textContent = matchData.player1.name;
            document.getElementById('player2-display').textContent = matchData.player2.name;
            
            // Update games
            document.getElementById('player1-games').textContent = matchData.player1.games;
            document.getElementById('player2-games').textContent = matchData.player2.games;
            
            // Update current server
            const serverName = matchData.currentServer === 0 ? matchData.player1.name : matchData.player2.name;
            document.getElementById('current-server').textContent = serverName;
            
            // Update serve data for current server
            const server = matchData.currentServer === 0 ? matchData.player1 : matchData.player2;
            document.getElementById('first-serve-data').textContent = server.firstServe || '-';
            document.getElementById('second-serve-data').textContent = server.secondServe || '-';
            
            // Calculate percentages
            const firstData = server.firstServe.replace(/,/g, '');
            const secondData = server.secondServe.replace(/,/g, '');
            const firstWins = (firstData.match(/1/g) || []).length;
            const firstTotal = firstData.length;
            const secondWins = (secondData.match(/1/g) || []).length;
            const secondTotal = secondData.length;
            
            document.getElementById('first-serve-percent').textContent = 
                firstTotal > 0 ? `${Math.round(firstWins / firstTotal * 100)}%` : '0%';
            document.getElementById('second-serve-percent').textContent = 
                secondTotal > 0 ? `${Math.round(secondWins / secondTotal * 100)}%` : '0%';
                
            // Update second shot displays
            const serverMisses = matchData.currentServer === 0 ? matchData.player1.secondShotMisses : matchData.player2.secondShotMisses;
            const returnerMisses = matchData.currentServer === 0 ? matchData.player2.secondShotMisses : matchData.player1.secondShotMisses;
            document.getElementById('server-misses').textContent = serverMisses;
            document.getElementById('returner-misses').textContent = returnerMisses;
            
            // Update results if on results tab
            updateResultsDisplay();
        }

        function updateResultsDisplay() {
            // Final score
            document.getElementById('final-player1').textContent = matchData.player1.name;
            document.getElementById('final-player2').textContent = matchData.player2.name;
            document.getElementById('final-player1-score').textContent = matchData.player1.games;
            document.getElementById('final-player2-score').textContent = matchData.player2.games;
            
            // Serve stats
            [matchData.player1, matchData.player2].forEach((player, index) => {
                const prefix = index === 0 ? 'p1' : 'p2';
                
                // Update names
                document.getElementById(`serve-${prefix}-name`).textContent = player.name;
                document.getElementById(`second-${prefix}-name`).textContent = player.name;
                
                // Calculate stats
                const firstData = player.firstServe.replace(/,/g, '');
                const secondData = player.secondServe.replace(/,/g, '');
                const totalServes = firstData.length + secondData.length;
                
                const firstServePct = totalServes > 0 ? Math.round(firstData.length / totalServes * 100) : 0;
                const firstWinPct = firstData.length > 0 ? Math.round((firstData.match(/1/g) || []).length / firstData.length * 100) : 0;
                const secondWinPct = secondData.length > 0 ? Math.round((secondData.match(/1/g) || []).length / secondData.length * 100) : 0;
                
                document.getElementById(`${prefix}-first-pct`).textContent = `${firstServePct}%`;
                document.getElementById(`${prefix}-first-win-pct`).textContent = `${firstWinPct}%`;
                document.getElementById(`${prefix}-second-win-pct`).textContent = `${secondWinPct}%`;
                
                // Second shot analysis
                document.getElementById(`${prefix}-second-misses`).textContent = player.secondShotMisses;
                
                let analysis = '';
                if (player.secondShotMisses === 0) analysis = 'Excellent!';
                else if (player.secondShotMisses <= 2) analysis = 'Good consistency';
                else if (player.secondShotMisses <= 4) analysis = 'Room for improvement';
                else analysis = 'Focus needed';
                
                document.getElementById(`${prefix}-analysis`).textContent = analysis;
            });
            
            // Overall insight
            const totalMisses = matchData.player1.secondShotMisses + matchData.player2.secondShotMisses;
            let insight = '';
            
            if (totalMisses === 0) {
                insight = 'Outstanding match! No second shot errors from either player.';
            } else if (totalMisses <= 3) {
                insight = `Good consistency with only ${totalMisses} second shot errors total.`;
            } else {
                insight = `${totalMisses} second shot errors - focus on getting that crucial second ball in play!`;
            }
            
            document.getElementById('match-insight').textContent = insight;
        }

        function newMatch() {
            matchData = {
                player1: { name: 'Player 1', games: 0, firstServe: '', secondServe: '', secondShotMisses: 0 },
                player2: { name: 'Player 2', games: 0, firstServe: '', secondServe: '', secondShotMisses: 0 },
                currentServer: 0,
                matchInfo: { date: '', location: '', surface: '' }
            };
            
            document.getElementById('player1-name').value = 'Player 1';
            document.getElementById('player2-name').value = 'Player 2';
            document.getElementById('match-location').value = 'Local Court';
            document.getElementById('match-surface').value = 'Hard';
            
            showTab('setup');
            updateAllDisplays();
        }

        function takeScreenshot() {
            window.print();
        }

        // Initialize
        init();
    </script>
</body>
</html>
